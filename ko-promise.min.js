/* ko-promise 2014-11-29 */
!function(a,b){function c(a){return a&&"function"==typeof a.then}function d(c,d,e,f){var g,h=!1;return a.computed(function(){return e()==f?(c&&!h&&(h=!0,g=c(d())),g===b&&(g=d()),g):b})}function e(){var c=a.observable();return a.computed({read:c,write:function(a){c()===b&&c(a)}})}function f(b){var c=a.observable(),d=a.observable();return b.then(c,d),g(a.computed({read:c}),d)}function g(c,e,f){e=e||a.observable();var h=f?j.fulfilled:j.pending,i=c.state=a.computed(function(){return h!==j.pending?h:c()!==b?h=j.fulfilled:e()!==b?h=j.rejected:j.pending});c.then=function(a,b){return g(d(a,c,i,j.fulfilled),d(b,e,i,j.rejected))},c.done=function(a){return this.then(a)},c["catch"]=c.fail=function(a){return this.then(null,a)},c.always=function(a){return this.then(a,a)};var k=c.dispose;return c.dispose=function(){c.state.dispose(),e.dispose&&e.dispose(),k&&k.call(c)},c}function h(b){return g(a.observable(b),a.observable(),!0)}var i=Array.prototype.slice,j={pending:"pending",fulfilled:"fulfilled",rejected:"rejected"},k=a.promise=function(b){return c(b)?a.isObservable(b)?b:f(b):a.isObservable(b)?g(b):h(b)};k.all=k.when=function(d){d=Array.isArray(d)?d:i.call(arguments);var e=[],f=a.observable(d.length),h=a.observable(),j=a.computed(function(){return 0===f()?e:b}),l=function(a,b){e[b]=a,f(f()-1)};return d.forEach(function(b,d){c(b)||a.isObservable(b)?k(b).then(function(a){l(a,d)},h):l(b,d)}),g(j,h)},k.race=function(b){b=Array.isArray(b)?b:i.call(arguments);for(var d,f=e(),h=e(),j=0,l=b.length;l>j;j++){if(d=b[j],!c(d)&&!a.isObservable(d)){f(d);break}k(d).then(f,h)}return g(f,h)}}(ko);